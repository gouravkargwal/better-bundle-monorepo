{% comment %}
  Product rendering logic for recommendation blocks
  Usage: {% render 'recommendation-products', context: 'product_page', dummy_data: dummy_data %}
{% endcomment %}

{% if request.design_mode %}
  <!-- Dummy data for design mode only -->
  {% if dummy_data %}
    {% assign dummy_products = dummy_data[0] | split: ',' %}
    {% assign dummy_prices = dummy_data[1] | split: ',' %}
    {% assign dummy_colors = dummy_data[2] | split: ',' %}
    {% assign dummy_quantities = dummy_data[4] | split: ',' %}
  {% else %}
    {% assign dummy_products = 'Product 1,Product 2,Product 3,Product 4' | split: ',' %}
    {% assign dummy_prices = '24.99,29.99,34.99,39.99' | split: ',' %}
    {% assign dummy_colors = 'cccccc,e0e0e0,d5d5d5,c7c7c7' | split: ',' %}
    {% assign dummy_quantities = '1,2,1,3' | split: ',' %}
  {% endif %}

  {% for product in dummy_products %}
    {% assign product_index = forloop.index0 %}
    {% assign product_id = 'design-mode-' | append: forloop.index %}
    <div class="swiper-slide">
      <div class="product-card" data-product-id="{{ product_id }}">
        <img
          class="product-card__image"
          src="https://via.placeholder.com/600x400/{{ dummy_colors[product_index] }}/666666?text={{ product | replace: ' ', '+' }}"
          alt="{{ product }}"
          width="600"
          height="400"
          loading="lazy"
          onclick="console.log('Design mode: Product clicked - {{ product }}')"
        >
        <div class="product-card__body">
          <h4 class="product-card__title">{{ product }}</h4>

          <!-- Line 1: Price and Quantity on same line (matches real structure) -->
          <div class="product-card__price-quantity">
            <p class="product-card__price" data-product-id="{{ product_id }}">${{ dummy_prices[product_index] }}</p>
            <div class="product-card__quantity">
              <button
                class="qty-btn qty-minus"
                type="button"
                onclick="event.stopPropagation(); console.log('Design mode: Quantity decreased')"
              >
                -
              </button>
              <input
                type="number"
                value="{{ dummy_quantities[product_index] | default: 1 }}"
                min="1"
                class="qty-input"
                placeholder="1"
                onclick="event.stopPropagation()"
                style="display: inline-block; width: 50px; height: 32px; border: 1px solid #e2e8f0; border-radius: 6px; text-align: center; font-size: 14px; color: #374151; background: #ffffff;"
              >
              <button
                class="qty-btn qty-plus"
                type="button"
                onclick="event.stopPropagation(); console.log('Design mode: Quantity increased')"
              >
                +
              </button>
            </div>
          </div>

          <!-- Line 2: Variant Dropdowns (2 side by side - matches real structure) -->
          <div class="product-card__variants two-dropdowns">
            <div class="variant-option">
              <label class="variant-label">Size</label>
              <select
                class="variant-select"
                onchange="event.stopPropagation(); console.log('Design mode: Size changed')"
                onclick="event.stopPropagation()"
              >
                {% assign size_options = 'Small,Medium,Large' | split: ',' %}
                {% for size in size_options %}
                  <option
                    value="{{ size | downcase }}"
                    {% if forloop.index == 2 %}
                      selected
                    {% endif %}
                  >
                    {{ size }}
                  </option>
                {% endfor %}
              </select>
            </div>
            <div class="variant-option">
              <label class="variant-label">Color</label>
              <select
                class="variant-select"
                onchange="event.stopPropagation(); console.log('Design mode: Color changed')"
                onclick="event.stopPropagation()"
              >
                {% assign color_options = 'Red,Blue,Green,Black' | split: ',' %}
                {% for color in color_options %}
                  <option
                    value="{{ color | downcase }}"
                    {% if forloop.index == 2 %}
                      selected
                    {% endif %}
                  >
                    {{ color }}
                  </option>
                {% endfor %}
              </select>
            </div>
          </div>

          <!-- Line 3: Add to Cart Button (matches real structure) -->
          <button
            class="product-card__btn"
            type="button"
            data-product-id="{{ product_id }}"
            onclick="event.stopPropagation(); console.log('Design mode: Add to cart clicked - {{ product }}')"
          >
            Add to cart
          </button>
        </div>
      </div>
    </div>
  {% endfor %}
{% else %}
  <!-- Initial skeleton for live mode -->
  {% render 'skeleton-loader', type: 'carousel', count: 4 %}
{% endif %}
