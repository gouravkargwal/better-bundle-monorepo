<!-- Phoenix Smart Recommendations Section -->

<!-- Recommendations Section -->
{% if block.settings.show_recommendations %}
<div class="phoenix-recommendations" 
     data-product-id="{{ block.settings.product.id }}" 
     data-context="{{ block.settings.context | default: 'auto' }}"
     data-limit="{{ block.settings.recommendation_limit | default: 3 }}"
     data-layout="{{ block.settings.layout_style | default: 'grid' }}"
     data-columns="{{ block.settings.grid_columns | default: 'auto' }}"
     data-show-prices="{{ block.settings.show_prices | default: true }}"
     data-show-reasons="{{ block.settings.show_reasons | default: true }}"
     data-template="{{ template }}"
     data-page-type="{{ request.page_type }}"
     data-locale="{{ request.locale.iso_code }}"
     data-theme="{{ theme.name | handleize }}">
  
  <!-- Loading State -->
  <div class="recommendations-loading" style="display: none;">
    <p>{{ 'recommendations.loading' | t }}</p>
  </div>
  
  <!-- Live Recommendations (populated by JavaScript) -->
  <div class="recommendations-content" style="display: none;">
    <h3>
      {% if block.settings.custom_title != blank %}
        {{ block.settings.custom_title }}
      {% elsif block.settings.context == 'auto' %}
        {{ 'recommendations.title' | t }}
      {% else %}
        {{ 'recommendations.contexts.' | append: block.settings.context | t }}
      {% endif %}
    </h3>
    <div class="phoenix-recommendations-grid">
      <!-- Recommendations will be populated here by JavaScript -->
    </div>
  </div>
  
  <!-- Preview/Dummy Data (shows only in theme editor) -->
  {% if request.design_mode %}
    <div class="phoenix-preview" style="display: block;">
  {% else %}
    <div class="phoenix-preview" style="display: none;">
  {% endif %}
    <h3>
      {% if block.settings.custom_title != blank %}
        {{ block.settings.custom_title }}
      {% elsif block.settings.context == 'auto' %}
        {{ 'recommendations.title' | t }}
      {% else %}
        {{ 'recommendations.contexts.' | append: block.settings.context | t }}
      {% endif %}
    </h3>
    
    <!-- Preview Grid -->
    <div class="phoenix-preview-grid" style="
      display: grid;
      {% if block.settings.grid_columns == 'auto' %}
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      {% else %}
        grid-template-columns: repeat({{ block.settings.grid_columns }}, 1fr);
      {% endif %}
      gap: 1rem;
      margin-top: 1rem;
    " data-layout="{{ block.settings.layout_style | default: 'grid' }}" data-columns="{{ block.settings.grid_columns | default: 'auto' }}">
      {% assign preview_limit = block.settings.recommendation_limit | default: 3 %}
      {% for i in (1..preview_limit) %}
        <div class="phoenix-preview-item" style="
          border: 1px solid #e0e0e0;
          border-radius: 8px;
          padding: 1rem;
          background: #f9f9f9;
          text-align: center;
        ">
          <!-- Product Image Placeholder -->
          <div style="
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), 
                        linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f0f0f0 75%), 
                        linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
          ">
            Product {{ i }}
          </div>
          
          <!-- Product Title Placeholder -->
          <div style="
            height: 20px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 0.5rem;
          "></div>
          
          <!-- Product Price Placeholder -->
          {% if block.settings.show_prices %}
            <div style="
              height: 16px;
              background: #e0e0e0;
              border-radius: 4px;
              width: 60%;
              margin: 0 auto 0.5rem;
            "></div>
          {% endif %}
          
          <!-- Recommendation Reason Placeholder -->
          {% if block.settings.show_reasons %}
            <div style="
              height: 14px;
              background: #e0e0e0;
              border-radius: 4px;
              width: 80%;
              margin: 0 auto;
            "></div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
    
    <!-- Preview Notice -->
    <div style="
      margin-top: 1rem;
      padding: 0.75rem;
      background: #e3f2fd;
      border: 1px solid #2196f3;
      border-radius: 4px;
      text-align: center;
      font-size: 14px;
      color: #1976d2;
    ">
      <strong>Preview Mode:</strong> This shows how your recommendations will look. 
      Real product recommendations will appear here once the widget is active.
    </div>
  </div>
</div>
{% endif %}

<!-- External Assets -->
<link rel="stylesheet" href="{{ 'phoenix-recommendations.css' | asset_url }}">
<script src="{{ 'context-detection.js' | asset_url }}" defer></script>
<script src="{{ 'recommendations.js' | asset_url }}" defer></script>

<!-- Initialization Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Wait for external scripts to load
  if (window.PhoenixRecommendations && window.PhoenixContextDetection) {
    window.PhoenixRecommendations.initializePhoenixRecommendations();
  } else {
    // Fallback: retry after a short delay
    setTimeout(() => {
      if (window.PhoenixRecommendations && window.PhoenixContextDetection) {
        window.PhoenixRecommendations.initializePhoenixRecommendations();
      }
    }, 100);
  }
});
</script>



{% schema %}
{
  "name": "Phoenix",
  "target": "section",
  "settings": [
    { "type": "product", "id": "product", "label": "Product", "autofill": true },
    { 
      "type": "select", 
      "id": "context", 
      "label": "Recommendation Context", 
      "info": "Choose where this widget will be used to get relevant recommendations (or set to 'auto' for automatic detection)",
      "options": [
        { "value": "auto", "label": "Auto-detect (Recommended)" },
        { "value": "product_page", "label": "Product Page - 'Customers also bought'" },
        { "value": "homepage", "label": "Homepage - 'Popular products'" },
        { "value": "cart", "label": "Cart - 'Frequently bought together'" },
        { "value": "collection", "label": "Collection - 'Similar products'" },
        { "value": "search", "label": "Search - 'You might also like'" },
        { "value": "blog", "label": "Blog - 'Featured products'" },
        { "value": "checkout", "label": "Checkout - 'Last chance to add'" },
        { "value": "account", "label": "Account - 'Recommended for you'" },
        { "value": "not_found", "label": "404 Page - 'Popular products'" }
      ],
      "default": "auto"
    },
    { "type": "checkbox", "id": "show_recommendations", "label": "Show Recommendations", "default": true },
    { 
      "type": "range", 
      "id": "recommendation_limit", 
      "label": "Number of Recommendations", 
      "info": "How many products to show (1-6)",
      "min": 1, 
      "max": 6, 
      "step": 1, 
      "default": 3 
    },
    {
      "type": "select",
      "id": "layout_style",
      "label": "Layout Style",
      "info": "Choose how recommendations are displayed",
      "options": [
        { "value": "grid", "label": "Grid Layout" },
        { "value": "carousel", "label": "Carousel/Slider" },
        { "value": "list", "label": "List Layout" }
      ],
      "default": "grid"
    },
    {
      "type": "select",
      "id": "grid_columns",
      "label": "Grid Columns",
      "info": "Number of columns in grid layout",
      "options": [
        { "value": "2", "label": "2 Columns" },
        { "value": "3", "label": "3 Columns" },
        { "value": "4", "label": "4 Columns" },
        { "value": "auto", "label": "Auto (Responsive)" }
      ],
      "default": "auto"
    },
    {
      "type": "checkbox",
      "id": "show_prices",
      "label": "Show Product Prices",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_reasons",
      "label": "Show Recommendation Reasons",
      "info": "Display why each product is recommended",
      "default": true
    },
    {
      "type": "text",
      "id": "custom_title",
      "label": "Custom Section Title",
      "info": "Override the default title (leave empty for auto-generated)"
    }
  ]
}
{% endschema %}
